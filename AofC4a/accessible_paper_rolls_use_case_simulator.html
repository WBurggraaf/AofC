<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Accessible Paper Rolls Use Case Simulator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 30px;
            background: #fafafa;
        }

        h2 {
            margin-top: 40px;
        }

        textarea {
            width: 100%;
            height: 180px;
            font-family: monospace;
        }

        button {
            padding: 10px 20px;
            margin-top: 10px;
        }

        #log {
            background: #fff;
            padding: 15px;
            white-space: pre-wrap;
            border: 1px solid #ccc;
            height: 300px;
            overflow-y: auto;
        }

        .error {
            color: #b00000;
            font-weight: bold;
        }

        .success {
            color: green;
            font-weight: bold;
        }

        .step {
            color: #004488;
        }
    </style>
</head>
<body>

    <h1>Accessible Paper Rolls — Use Case Execution Simulator</h1>
    <p>This tool demonstrates each step of the Craig Larman–style use case, including success and error extensions.</p>

    <h2>Grid Input</h2>
<textarea id="gridInput" placeholder="Enter your grid of @ and . characters"></textarea>
    <button onclick="runUseCase()">Run Use Case</button>

    <h2>Event Log</h2>
    <div id="log"></div>

    <script>
function log(msg, type="info") {
    const logDiv = document.getElementById("log");
    let css = "";
    if (type === "error") css = "error";
    if (type === "success") css = "success";
    if (type === "step") css = "step";
    logDiv.innerHTML += `<div class="${css}">${msg}</div>`;
    logDiv.scrollTop = logDiv.scrollHeight;
}

function runUseCase() {
    document.getElementById("log").innerHTML = "";
    log("=== Use Case Execution Started ===", "step");

    const raw = document.getElementById("gridInput").value.trim();

    // Step 1: Receive Grid
    log("Step 1: System receives the grid input.", "step");

    if (!raw) {
        log("Error: EmptyGridError — The grid contains no data.", "error");
        return;
    }

    // Step 2: Validate characters
    log("Step 2: System validates allowed characters (@ and .).", "step");

    const rows = raw.split("\n");
    const validPattern = /^[.@]+$/;

    for (let r = 0; r < rows.length; r++) {
        if (!validPattern.test(rows[r])) {
            log(`InvalidGridFormatError: Row ${r+1} contains illegal characters.`, "error");
            return;
        }
    }

    // Step 3: Validate row length consistency
    log("Step 3: System checks for consistent row lengths.", "step");

    const expectedLen = rows[0].length;
    for (let r = 0; r < rows.length; r++) {
        if (rows[r].length !== expectedLen) {
            log(`InconsistentRowLengthError: Row ${r+1} does not match expected length (${expectedLen}).`, "error");
            return;
        }
    }

    // Step 4: Parse grid
    log("Step 4: System parses grid into 2D array.", "step");
    const grid = rows.map(r => r.split(""));

    // Step 5: Evaluate accessibility
    log("Step 5: System evaluates each roll’s 8-neighbor adjacency.", "step");

    let accessibleCount = 0;

    const directions = [
        [-1, -1], [-1, 0], [-1, 1],
        [0, -1],          [0, 1],
        [1, -1], [1, 0], [1, 1]
    ];

    for (let r = 0; r < grid.length; r++) {
        for (let c = 0; c < grid[0].length; c++) {
            if (grid[r][c] !== "@") continue;

            let count = 0;

            // Step 4a: Edge cell handling
            directions.forEach(([dr, dc]) => {
                const nr = r + dr, nc = c + dc;
                if (nr >= 0 && nr < grid.length && nc >= 0 && nc < grid[0].length) {
                    if (grid[nr][nc] === "@") count++;
                }
            });

            if (count < 4) {
                accessibleCount++;
                log(`Accessible roll at (${r}, ${c}) with ${count} neighbors.`);
            }
        }
    }

    // Step 6: Aggregate
    log("Step 6: System aggregates all accessible rolls.", "step");

    // Step 6a: No accessible rolls
    if (accessibleCount === 0) {
        log("No accessible rolls found (0).", "step");
    }

    // Step 7: Return output
    log("Step 7: Returning result.", "step");
    log(`Accessible Rolls: ${accessibleCount}`, "success");

    log("=== Use Case Completed ===", "step");
}
    </script>

</body>
</html>
