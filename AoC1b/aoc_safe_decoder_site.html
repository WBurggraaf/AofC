<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>North Pole Secret Entrance ‚Äì Animated Safe Decoder</title>

    <style>
        body {
            font-family: sans-serif;
            margin: 2rem;
            line-height: 1.5;
        }

        textarea {
            width: 100%;
            height: 200px;
            font-family: monospace;
        }

        .result {
            margin-top: 1rem;
            padding: 1rem;
            border: 1px solid #ccc;
            background: #fafafa;
        }

        .error {
            color: red;
        }

        .warning {
            color: #c47a00;
        }

        /* ---------------- VAULT + ELF ---------------- */

        .vault-container {
            display: flex;
            gap: 2rem;
            margin-top: 2rem;
            align-items: center;
        }

        .vault {
            width: 200px;
            height: 200px;
            background: #888;
            border: 10px solid #444;
            border-radius: 50%;
            position: relative;
            display: grid;
            place-items: center;
            box-shadow: 0 0 20px #222 inset;
        }

        .dial {
            width: 120px;
            height: 120px;
            background: #222;
            border-radius: 50%;
            border: 6px solid #555;
            position: relative;
            transition: transform 0.25s linear;
            display: grid;
            place-items: center;
            color: white;
            font-size: 1.5rem;
        }

            .dial::after {
                content: "";
                width: 6px;
                height: 30px;
                background: red;
                position: absolute;
                top: -5px;
            }

        /* Elf */

        .elf {
            width: 140px;
            font-size: 4rem;
            transition: transform 0.5s ease, opacity 0.5s ease;
        }

            .elf.happy {
                transform: scale(1.3) rotate(-10deg);
            }

            .elf.sad {
                opacity: 0.5;
            }

        /* Animation status message */
        .status {
            font-size: 1.2rem;
            margin-top: 1rem;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <h1>Secret Entrance Safe Decoder (Animated)</h1>

    <p>
        This console simulates the North Pole Secret Entrance Control System using
        method <strong>0x434C49434B</strong>‚Äînow with animation.
    </p>

    <form onsubmit="computePassword(); return false;">
        <textarea id="inputText" placeholder="Enter rotations like:
L68
R12
L5"></textarea>
        <br /><br />
        <button type="submit">Compute Password</button>
    </form>

    <div id="output" class="result"></div>

    <!-- ANIMATION AREA -->
    <div class="vault-container">
        <div class="vault">
            <div class="dial" id="dialVisual">50</div>
        </div>
        <div class="elf" id="elf">üßù‚Äç‚ôÇÔ∏è</div>
    </div>

    <div class="status" id="status"></div>

    <script>
        let isAnimating = false;

        function sleep(ms) {
            return new Promise(r => setTimeout(r, ms));
        }

        async function animateDial(direction, steps) {
            let dial = Number(document.getElementById("dialVisual").textContent);

            for (let i = 0; i < steps; i++) {
                if (direction === "L") {
                    dial = (dial - 1 + 100) % 100;
                } else {
                    dial = (dial + 1) % 100;
                }

                // Rotate dial visual
                const dialElement = document.getElementById("dialVisual");
                dialElement.textContent = dial;
                dialElement.style.transform = `rotate(${dial * 3.6}deg)`;

                document.getElementById("status").textContent =
                    `Dial moved to ${dial}`;

                await sleep(1); // Animation speed
            }

            return dial;
        }

        async function computePassword() {
            if (isAnimating) return;
            isAnimating = true;

            const output = document.getElementById("output");
            const status = document.getElementById("status");
            const elf = document.getElementById("elf");

            output.innerHTML = "";
            status.textContent = "";
            elf.classList.remove("happy", "sad");

            const text = document.getElementById("inputText").value.trim();

            if (!text) {
                output.innerHTML = `<p class="error"><strong>E1:</strong> No rotation document provided.</p>`;
                isAnimating = false;
                return;
            }

            const lines = text.split(/\r?\n/)
                .map(l => l.trim()).filter(l => l.length > 0);
            const instructions = [];
            const errors = [];

            for (let i = 0; i < lines.length; i++) {
                const match = /^(L|R)(\d+)$/.exec(lines[i]);
                if (!match) {
                    errors.push(`E1 (Line ${i + 1}): Invalid rotation instruction '${lines[i]}'`);
                    continue;
                }
                instructions.push({
                    dir: match[1],
                    dist: parseInt(match[2], 10)
                });
            }

            if (errors.length > 0) {
                output.innerHTML = `
                    <h2>Input Errors</h2>
                    <p class="error">The rotation document is invalid. Computation aborted.</p>
                    <ul>${errors.map(e => `<li class="error">${e}</li>`).join("")}</ul>
                `;
                isAnimating = false;
                return;
            }

            if (instructions.length === 0) {
                output.innerHTML = `
                    <p class="warning"><strong>Warning:</strong> No rotations found.<br>
                    The dial remains at 50 and no zero hits occur.<br>
                    The password would be <strong>0</strong>.</p>
                `;
                isAnimating = false;
                return;
            }

            // Start dial at 50
            let dial = 50;
            document.getElementById("dialVisual").textContent = "50";
            document.getElementById("dialVisual").style.transform = "rotate(180deg)";
            let zeroCount = 0;

            status.textContent = "Starting animation...";

            // Animate each instruction
            for (let step of instructions) {
                const dir = step.dir;
                const dist = step.dist;

                const fullCycles = Math.floor(dist / 100);
                const remainder = dist % 100;

                zeroCount += fullCycles;

                for (let cycle = 0; cycle < fullCycles; cycle++) {
                    await animateDial(dir, 100);
                }

                dial = await animateDial(dir, remainder);
                if (dial === 0) zeroCount++;
            }

            status.textContent = "Animation done.";

            output.innerHTML = `
                <h2>Password Computed</h2>
                <p><strong>Password:</strong> ${zeroCount}</p>
                <p>Apply this password to unlock the door?</p>
                <button onclick="unlockDoor(${zeroCount})">Yes, unlock</button>
                <button onclick="cancelOperation()">No, cancel</button>
            `;

            isAnimating = false;
        }


        function unlockDoor(password) {
            const output = document.getElementById("output");
            const elf = document.getElementById("elf");

            if (password <= 0) {
                output.innerHTML = `<p class="error">E3: Door rejected password ‚Äì possibly outdated method.</p>`;
                elf.classList.add("sad");
                return;
            }

            elf.classList.add("happy");

            output.innerHTML = `
                <h2>Door Unlocked!</h2>
                <p>The secret entrance is now open.</p>
            `;
        }

        function cancelOperation() {
            document.getElementById("output").innerHTML =
                `<p>Operation canceled. Door remains locked.</p>`;
            document.getElementById("elf").classList.remove("happy", "sad");
        }
    </script>

</body>
</html>
